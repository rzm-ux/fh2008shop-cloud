<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
	<title>结算页</title>
	<link href="../../js/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../../js/shop/css/webbase.css" />
	<link rel="stylesheet" type="text/css" href="../../js/shop/css/pages-getOrderInfo.css" />
</head>

<body>
<div class="top">
	<div class="py-container">
		<div class="shortcut">
			<ul class="fl" id="userMember">
			</ul>
			<ul class="fr">
				<li class="f-item">我的订单</li>
				<li class="f-item space"></li>
				<li class="f-item">我的品优购</li>
				<li class="f-item space"></li>
				<li class="f-item">品优购会员</li>
				<li class="f-item space"></li>
				<li class="f-item">企业采购</li>
				<li class="f-item space"></li>
				<li class="f-item">关注品优购</li>
				<li class="f-item space"></li>
				<li class="f-item">客户服务</li>
				<li class="f-item space"></li>
				<li class="f-item">网站导航</li>
			</ul>
		</div>
	</div>
</div>
<div class="cart py-container">
	<!--logoArea-->
	<div class="logoArea">
		<div class="fl logo"><span class="title">结算页</span></div>
		<div class="fr search">
			<form class="sui-form form-inline">
				<div class="input-append">
					<input type="text" type="text"  placeholder="品优购自营" />
					<button class="sui-btn btn-xlarge btn-danger" type="button">搜索</button>
				</div>
			</form>
		</div>
	</div>
	<!--主内容-->
	<div class="checkout py-container">
		<div class="checkout-tit">
			<h4 class="tit-txt">填写并核对订单信息</h4>
		</div>
		<div class="checkout-steps">
			<!--收件人信息-->
			<div class="step-tit">
				<h5>收件人信息<span><a class="newadd" onclick="addRecipient()">新增收货地址</a></span></h5>
			</div>
			<div class="step-cont">
				<div class="addressInfo">
					<ul class="addr-detail">
						<li class="addr-item" id="userAddresss">

							<div>
								<div class="con name selected"><a href="javascript:;" >张默<span title="点击取消选择">&nbsp;</a></div>
								<div class="con address">张默 北京市海淀区三环内 中关村软件园9号楼 <span>159****3201</span>
									<span class="base">默认地址</span>
									<span class="edittext"><a data-toggle="modal" data-target=".edit" data-keyboard="false" >编辑</a>&nbsp;&nbsp;<a href="javascript:;">删除</a></span>
								</div>
								<div class="clearfix"></div>
							</div>

						</li>
					</ul>
					<!--添加地址-->
					<!--确认地址-->
				</div>
				<div class="hr"></div>
			</div>
			<div class="hr"></div>
			<!--支付和送货-->
			<div class="payshipInfo">
				<div class="step-tit">
					<h5>支付方式</h5>
				</div>
				<div class="step-cont">
					<ul class="payType">
						<li class="selected" value="1">微信付款<span title="点击取消选择"></span></li>
						<li value="2">支付宝付款<span title="点击取消选择"></span></li>
					</ul>
				</div>
				<div class="hr"></div>
				<div class="step-tit">
					<h5>送货清单</h5>
				</div>
				<div class="step-cont">
					<ul class="send-detail">
						<li>
							<div class="sendGoods">
								<ul class="yui3-g" id="userMemberSku">
									<li class="yui3-u-1-6">
										<span><img src="img/goods.png"/></span>
									</li>
									<li class="yui3-u-7-12">
										<div class="desc">Apple iPhone 6s (A1700) 64G 玫瑰金色 移动联通电信4G手机硅胶透明防摔软壳 本色系列</div>
										<div class="seven">7天无理由退货</div>
									</li>
									<li class="yui3-u-1-12">
										<div class="price">￥5399.00</div>
									</li>
									<li class="yui3-u-1-12">
										<div class="num">X1</div>
									</li>
									<li class="yui3-u-1-12">
										<div class="exit">有货</div>
									</li>
								</ul>
							</div>
						</li>

					</ul>
				</div>
				<div class="hr"></div>
			</div>
			<div class="linkInfo">
				<div class="step-tit">
					<h5>发票信息</h5>
				</div>
				<div class="step-cont">
					<span>普通发票（电子）</span>
					<span>个人</span>
					<span>明细</span>
				</div>
			</div>
			<div class="cardInfo">
				<div class="step-tit">
					<h5>使用优惠/抵用</h5>
				</div>
			</div>
		</div>
	</div>

	<div  id="settlement"  style="display: none">
		<form action="" class="sui-form form-horizontal">
			<div class="control-group">
				<label class="control-label">收货人：</label>
				<div class="controls">
					<input type="text" class="input-medium" id="add_realName">
				</div>
			</div>

			<div class="control-group">
				<label class="control-label">详细地址：</label>
				<div class="controls">
					<input type="text" class="input-large" id="add_address">
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">联系电话：</label>
				<div class="controls">
					<input type="text" class="input-medium" id="add_phone">
				</div>
			</div>
		</form>
	</div>
	<div  id="edit_settlement"  style="display: none">
		<form action="" class="sui-form form-horizontal">
			<div class="control-group">
				<label class="control-label">收货人：</label>
				<div class="controls">
					<input type="text" class="input-medium" id="edit_realName">
				</div>
			</div>


			<div class="control-group">
				<label class="control-label">联系电话：</label>
				<div class="controls">
					<input type="text" class="input-medium" id="edit_phone">
				</div>
			</div>

			<div class="control-group">
				<label class="control-label">详细地址：</label>
				<div class="controls">
					<input type="text" class="input-large" id="edit_address">
				</div>
			</div>

		</form>
	</div>
	<div class="order-summary">
		<div class="static fr">
			<div class="list" id="userMembers">

			</div>
			<div class="list">
				<span>返现：</span>
				<em class="money">0.00</em>
			</div>
			<div class="list">
				<span>运费：</span>
				<em class="transport">0.00</em>
			</div>
		</div>
	</div>
	<div class="clearfix trade" id="userPrice">
		<div class="fc-price" id="userNames" >应付金额:　</div>

	</div>
	<div class="submit">
		<a class="sui-btn btn-danger btn-xlarge" href="#"  onclick="orderSuccess()">提交订单</a>
	</div>
</div>
<!-- 底部栏位 -->
<!--页面底部-->
<div class="clearfix footer">
	<div class="py-container">
		<div class="footlink">
			<div class="Mod-service">
				<ul class="Mod-Service-list">
					<li class="grid-service-item intro  intro1">

						<i class="serivce-item fl"></i>
						<div class="service-text">
							<h4>正品保障</h4>
							<p>正品保障，提供发票</p>
						</div>

					</li>
					<li class="grid-service-item  intro intro2">

						<i class="serivce-item fl"></i>
						<div class="service-text">
							<h4>正品保障</h4>
							<p>正品保障，提供发票</p>
						</div>

					</li>
					<li class="grid-service-item intro  intro3">

						<i class="serivce-item fl"></i>
						<div class="service-text">
							<h4>正品保障</h4>
							<p>正品保障，提供发票</p>
						</div>

					</li>
					<li class="grid-service-item  intro intro4">

						<i class="serivce-item fl"></i>
						<div class="service-text">
							<h4>正品保障</h4>
							<p>正品保障，提供发票</p>
						</div>

					</li>
					<li class="grid-service-item intro intro5">

						<i class="serivce-item fl"></i>
						<div class="service-text">
							<h4>正品保障</h4>
							<p>正品保障，提供发票</p>
						</div>

					</li>
				</ul>
			</div>
			<div class="clearfix Mod-list">
				<div class="yui3-g">
					<div class="yui3-u-1-6">
						<h4>购物指南</h4>
						<ul class="unstyled">
							<li>购物流程</li>
							<li>会员介绍</li>
							<li>生活旅行/团购</li>
							<li>常见问题</li>
							<li>购物指南</li>
						</ul>

					</div>
					<div class="yui3-u-1-6">
						<h4>配送方式</h4>
						<ul class="unstyled">
							<li>上门自提</li>
							<li>211限时达</li>
							<li>配送服务查询</li>
							<li>配送费收取标准</li>
							<li>海外配送</li>
						</ul>
					</div>
					<div class="yui3-u-1-6">
						<h4>支付方式</h4>
						<ul class="unstyled">
							<li>货到付款</li>
							<li>在线支付</li>
							<li>分期付款</li>
							<li>邮局汇款</li>
							<li>公司转账</li>
						</ul>
					</div>
					<div class="yui3-u-1-6">
						<h4>售后服务</h4>
						<ul class="unstyled">
							<li>售后政策</li>
							<li>价格保护</li>
							<li>退款说明</li>
							<li>返修/退换货</li>
							<li>取消订单</li>
						</ul>
					</div>
					<div class="yui3-u-1-6">
						<h4>特色服务</h4>
						<ul class="unstyled">
							<li>夺宝岛</li>
							<li>DIY装机</li>
							<li>延保服务</li>
							<li>品优购E卡</li>
							<li>品优购通信</li>
						</ul>
					</div>
					<div class="yui3-u-1-6">
					</div>
				</div>
			</div>
			<div class="Mod-copyright">
				<ul class="helpLink">
					<li>关于我们<span class="space"></span></li>
					<li>联系我们<span class="space"></span></li>
					<li>关于我们<span class="space"></span></li>
					<li>商家入驻<span class="space"></span></li>
					<li>营销中心<span class="space"></span></li>
					<li>友情链接<span class="space"></span></li>
					<li>关于我们<span class="space"></span></li>
					<li>营销中心<span class="space"></span></li>
					<li>友情链接<span class="space"></span></li>
					<li>关于我们</li>
				</ul>
			</div>
		</div>
	</div>
</div>
<!--页面底部END-->
<script type="text/javascript" src="../../js/shop/js/plugins/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../js/shop/js/plugins/jquery.easing/jquery.easing.min.js"></script>
<script type="text/javascript" src="../../js/shop/js/plugins/sui/sui.min.js"></script>
<script src="../../js/jquery.cookie.min.js"></script>
<script src="../../js/bootbox/bootbox.min.js"></script>
<script src="../../js/bootstrap/js/bootstrap.min.js"></script>
<script src="../../js/bootbox/bootbox.locales.min.js"></script>
<script type="text/javascript" src="../../js/common/server_url.js"></script>
<script>
function addRecipient() {
    //备份
    var v_userHtml=$("#settlement").html();
    var v_edituserDlg=bootbox.dialog({
        title: "新增收货人",
        message:$("#settlement form"),
        size:'large',
        buttons: {
            confirm: {
                label: ' <span class="glyphicon glyphicon-ok"></span>确认',
                className: 'btn-primary',
                callback: function () {
                    //更新的操作
                    //获取参数
                    var  v_realName=$("#add_realName",v_edituserDlg).val();
                    var v_phone=$("#add_phone",v_edituserDlg).val();
                    var v_addresss=$("#add_address",v_edituserDlg).val();
                    var param={};
                    param.realName=v_realName;
                    param.phone=v_phone;
                    param.address=v_addresss;
                    //发送ajax请求 传递参数到后台
                    $.ajax({
                        type: "post",
                        url: server_url+"/users/addUser",
                        data: param,
                        beforeSend:function (xhr) {
                            var v_toKen=$.cookie("toKen");
                            xhr.setRequestHeader("x-auth",v_toKen);
                        },
                        success: function (result) {
                            if (result.code == 200) {
                                queryRecipient();
                                //添加成功，返回状态200
                            }
                        },

                    })
                }
            },
            cancel:{
                label:' <span class="glyphicon glyphicon-remove"></span>取消',
                className:'btn-danger'
            }
        }
    })
    //还原
    $("#settlement").html(v_userHtml);

}
    function orderSuccess() {

			var v_id=$("#settementId").val();
			console.log(v_id);
		    var v_param={};
		    v_param.settlementId=v_id;
		    v_param.payType=1;
				$.ajax({
			type:"post",
			data:v_param,
			url:server_url+"/orders/addOrder",
            beforeSend:function (xhr) {
                var v_toKen=$.cookie("toKen");
                xhr.setRequestHeader("x-auth",v_toKen);
                xhr.setRequestHeader("x-token",v_toKen);
            },
			success:function (res) {
				if (res.code==200){
				 location.href="orderSuccess.html";
			}
         }
		})
    }
    function cartInfo() {
        $.ajax({
            type:"get",
            beforeSend:function (xhr) {
                var v_toKen=$.cookie("toKen");
                xhr.setRequestHeader("x-auth",v_toKen);
            },
            url:server_url+"/carts/queryCart",
            success:function (res) {
                if (res.data==null){
                    $("#userMemberSku").html("<a  href='index-student.html'><h1  align='center'>请您点击，返回购物!</h1></a>");
                    return false;
                }
                var v_cartItemList=res.data.cartItemVoList;
                var v_price=res.data.totalPrice;
                var v_count=res.data.totalcount;
                var t_html='';
                for (let cart of v_cartItemList) {
                    t_html+='\t<li class="yui3-u-1-6">\n' +
                        '\t\t\t\t\t\t\t\t\t\t<span><img src="'+cart.skuImage+'"/></span>\n' +
                        '\t\t\t\t\t\t\t\t\t</li>\n' +
                        '\t\t\t\t\t\t\t\t\t<li class="yui3-u-7-12">\n' +
                        '\t\t\t\t\t\t\t\t\t\t<div class="desc">'+cart.skuName+'</div>\n' +
                        '\t\t\t\t\t\t\t\t\t\t<div class="seven">7天无理由退货</div>\n' +
                        '\t\t\t\t\t\t\t\t\t</li>\n' +
                        '\t\t\t\t\t\t\t\t\t<li class="yui3-u-1-12">\n' +
                        '\t\t\t\t\t\t\t\t\t\t<div class="price">￥'+cart.price+'</div>\n' +
                        '\t\t\t\t\t\t\t\t\t</li>\n' +
                        '\t\t\t\t\t\t\t\t\t<li class="yui3-u-1-12">\n' +
                        '\t\t\t\t\t\t\t\t\t\t<div class="num">X1</div>\n' +
                        '\t\t\t\t\t\t\t\t\t</li>\n' +
                        '\t\t\t\t\t\t\t\t\t<li class="yui3-u-1-12">\n' +
                        '\t\t\t\t\t\t\t\t\t\t<div class="exit">有货</div>\n' +
                        '\t\t\t\t\t\t\t\t\t</li>'
                }
                $("#userMemberSku").html(t_html);
                var v_html='\t\t<span><i class="number">'+v_count+'</i>件商品，总商品金额</span>\n' +
                    '\t\t\t\t<em class="allprice">￥'+v_price+'</em>'
                var v_html1='　<span class="price">'+v_price+'</span></div>'
                $("#userNames").html(v_html1);
                console.log(res.data);
                $("#userMembers").html(v_html);
            }
        })
    }
    $(function () {
        queryRecipient();
        findMember();
        initEvent();
        cartInfo();

    })
    function findMember() {
        $.ajax({
            type:"get",
            url:server_url+"/meber/findMember",
            beforeSend:function (xhr) {
                var v_toKen=$.cookie("toKen");
                xhr.setRequestHeader("x-auth",v_toKen);
            },
            success:function (res) {
                if (res.code==200){
                    $("#userMember").append('<li class="f-item">品优购欢迎您</li><li class="f-item">'+res.data.nickName+'!&nbsp;&nbsp;&nbsp;</li><li class="f-item"><a href="#" onclick="findLogun()">注销&nbsp;&nbsp;&nbsp;</a></li >  <li class="f-item"><a href="update.html" onclick="updatePasswo()">修改密码&nbsp;&nbsp;&nbsp;</a></li><li class="f-item"><a href="cart-student.html" >购物车('+res.data.count+')&nbsp;&nbsp;&nbsp;</a></li>\n')
                }else {
                    $("#userMember").append('<li class="f-item">品优购欢迎您！</li><li class="f-item"><a href="list.html">请登录&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a></li><li class="f-item"><a href="add.html">注册</a></li>\n')

                }
            }
        })
    }
    function updates(id) {
        $.ajax({
            type:"get",
            url:server_url+"/users/updateUserQuery",
            data:{"id":id},
            beforeSend:function (xhr) {
                var v_toKen=$.cookie("toKen");
                xhr.setRequestHeader("x-auth",v_toKen);
            },
            success:function (result) {
                console.log(result);
                if (result.code==200){
                    var v_user=result.data;
                    //回填数据
                    $("#edit_realName").val(v_user.realName);
                    $("#edit_phone").val(v_user.phone);
                    $("#edit_address").val(v_user.address);
                    //备份
                    var v_userHtml=$("#edit_settlement").html();
                    var v_edituserDlg=bootbox.dialog({
                        title: "修改品牌",
                        message:$("#edit_settlement form"),
                        size:'large',
                        buttons: {
                            confirm: {
                                label: ' <span class="glyphicon glyphicon-ok"></span>确认',
                                className: 'btn-primary',
                                callback: function () {
                                    //更新的操作
                                    //获取参数
                                    var  v_realName=$("#edit_realName",v_edituserDlg).val();
                                    var v_phone=$("#edit_phone",v_edituserDlg).val();
                                    var v_addresss=$("#edit_address",v_edituserDlg).val();
                                    var param={};
                                    param.realName=v_realName;
                                    param.phone=v_phone;
                                    param.address=v_addresss;
                                    param.id=v_user.id;
                                    //发送ajax请求 传递参数到后台
                                    $.ajax({
                                        type: "put",
                                        url: server_url+"/users/updateUser",
                                        data: param,
                                        beforeSend:function (xhr) {
                                            var v_toKen=$.cookie("toKen");
                                            xhr.setRequestHeader("x-auth",v_toKen);
                                        },
                                        success: function (result) {
                                            if (result.code == 200) {
                                                queryRecipient();
                                                //添加成功，返回状态200
                                            }
                                        },

                                    })
                                }
                            },
                            cancel:{
                                label:' <span class="glyphicon glyphicon-remove"></span>取消',
                                className:'btn-danger'
                            }
                        }
                    })
                    //还原
                    $("#edit_settlement").html(v_userHtml);
                }
            }
        })
    }
    function userAdds(id,obj) {
        for (let list of v_user) {
			if (list.id==id){
                $("#userPrice").html('寄送至:'+list.address+' 收货人：'+list.realName+' '+list.phone+'<input type="hidden" value="'+id+'" id="settementId">');
            }
        }
        //重置
        $(".con.address").css("font-weight","")
		//设置
        $(obj).css("font-weight","bold")
    }
    var   v_user;
    function queryRecipient() {
        $.ajax({
            type:"get",
            url:server_url+"/users/queryUser",
            beforeSend:function (xhr) {
                var v_toKen=$.cookie("toKen");
                xhr.setRequestHeader("x-auth",v_toKen);
            },
            success:function (res) {
                   v_user=res.data;
				console.log(res);
                var	v_html="";
                for (let user of v_user) {
                    var v_status=user.status==1?"<span class=\"base\">默认地址</span>":"";
                    var v_statuss=user.status==1?"selected":"";
                    var v_font=user.status==1?"font-weight: bold":"";
                    v_html+='\t<div >\n' +
                        '<div class="con name '+v_statuss+'" onclick="userStatus('+user.id+')"><a href="javascript:;" >'+user.realName+'&nbsp;&nbsp;&nbsp;<span title="点击取消选择">&nbsp;&nbsp;&nbsp;</a></div>\n' +
                        '<div class="con address"   onclick="userAdds('+user.id+',this)" style="'+v_font+'">'+user.address+'&nbsp;&nbsp;&nbsp;<span>'+user.phone+'</span>\n' +
                        ''+v_status+'\n' +
                        '<span style="display: none" ><a onclick="updates('+user.id+')">编辑</a>&nbsp;&nbsp;<a href="javascript:;"onclick="deletes('+user.id+')">删除</a></span>\n' +
                        '</div>\n'+
                        '<div class="clearfix"></div>\n' +
                        '</div>'
                }
                $("#userAddresss").html(v_html);
                initEvent();
            }
        })
    }
	function initEvent() {
		$(".con.address").hover(function () {
			$(this).children().last().show();
        },
		function () {
            $(this).children().last().hide();
        }
		)
    }

function userStatus(id) {
        $.ajax({
			type:"get",
			url:server_url+"/users/updateUserStatus",
			data:{"id":id},
            beforeSend:function (xhr) {
                var v_toKen=$.cookie("toKen");
                xhr.setRequestHeader("x-auth",v_toKen);
            },
			success:function (res) {
				if (res.code==200){
				    queryRecipient();
				}
            }
		})

}

</script>
</body>

</html>